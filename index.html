<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tausug-English Dictionary</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
      min-height: 100vh;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background-color: white;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      overflow: hidden;
    }
    header {
      background: linear-gradient(to right, #6a11cb, #2575fc);
      color: white;
      padding: 25px;
      text-align: center;
    }
    h1 {
      margin: 0;
      font-size: 2.2rem;
    }
    .subtitle {
      margin-top: 5px;
      opacity: 0.9;
    }
    .app-content {
      padding: 25px;
    }
    #search-container {
      text-align: center;
      margin-bottom: 30px;
      position: relative;
    }
    #search {
      width: 70%;
      padding: 12px 20px;
      font-size: 16px;
      border: 2px solid #ddd;
      border-radius: 50px;
      outline: none;
      transition: border-color 0.3s;
    }
    #search:focus {
      border-color: #6a11cb;
    }
    #suggestions {
      position: absolute;
      background: white;
      border: 1px solid #ddd;
      width: 70%;
      left: 15%;
      max-height: 200px;
      overflow-y: auto;
      z-index: 1000;
      border-radius: 0 0 10px 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      display: none;
    }
    #suggestions div {
      padding: 10px 15px;
      cursor: pointer;
      border-bottom: 1px solid #f0f0f0;
    }
    #suggestions div:last-child {
      border-bottom: none;
    }
    #suggestions div:hover {
      background-color: #f5f5f5;
    }
    #add-form {
      display: flex;
      justify-content: center;
      margin-bottom: 30px;
      gap: 10px;
      flex-wrap: wrap;
    }
    #add-form input {
      padding: 12px;
      font-size: 16px;
      border: 2px solid #ddd;
      border-radius: 8px;
      width: 200px;
      transition: border-color 0.3s;
    }
    #add-form input:focus {
      outline: none;
      border-color: #6a11cb;
    }
    #addBtn {
      padding: 12px 25px;
      font-size: 16px;
      cursor: pointer;
      background: linear-gradient(to right, #2ecc71, #27ae60);
      color: white;
      border: none;
      border-radius: 8px;
      transition: all 0.3s;
    }
    #addBtn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
    th, td {
      border: 1px solid #e0e0e0;
      padding: 15px;
      text-align: left;
    }
    th {
      background-color: #f8f9fa;
      font-weight: 600;
      color: #444;
    }
    tr:hover {
      background-color: #f8f9fa;
    }
    .delete-btn {
      background-color: #e74c3c;
      color: white;
      border: none;
      padding: 8px 15px;
      cursor: pointer;
      border-radius: 4px;
      transition: background-color 0.3s;
    }
    .delete-btn:hover {
      background-color: #c0392b;
    }
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      background: #2ecc71;
      color: white;
      border-radius: 8px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      display: none;
      z-index: 1000;
    }
    .notification.error {
      background: #e74c3c;
    }
    .notification.show {
      display: block;
      animation: fadeIn 0.3s, fadeOut 0.3s 2.7s forwards;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeOut {
      from { opacity: 1; transform: translateY(0); }
      to { opacity: 0; transform: translateY(-20px); }
    }
    .loading {
      text-align: center;
      padding: 20px;
      color: #6c757d;
    }
    footer {
      text-align: center;
      padding: 15px;
      background-color: #f8f9fa;
      color: #6c757d;
      margin-top: 30px;
    }
    @media (max-width: 768px) {
      #search {
        width: 90%;
      }
      #suggestions {
        width: 90%;
        left: 5%;
      }
      #add-form {
        flex-direction: column;
        align-items: center;
      }
      #add-form input {
        width: 90%;
      }
      table {
        font-size: 14px;
      }
      th, td {
        padding: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Tausug-English Dictionary</h1>
      <div class="subtitle">Add, search, and manage Tausug words and their English translations</div>
    </header>
    
    <div class="app-content">
      <div id="search-container">
        <input type="text" id="search" placeholder="Search Tausug or English word...">
        <div id="suggestions"></div>
      </div>

      <div id="add-form">
        <input type="text" id="tausug" placeholder="Tausug Word">
        <input type="text" id="english" placeholder="English Meaning">
        <button id="addBtn">Add Word</button>
      </div>

      <div id="wordsTableContainer">
        <table>
          <thead>
            <tr>
              <th>Tausug</th>
              <th>English</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="wordsTable">
            <tr>
              <td colspan="3" class="loading">Loading dictionary...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <footer>
      <p>Tausug-English Dictionary &copy; 2025 | Built with Firebase</p>
    </footer>
  </div>

  <div class="notification" id="notification">Operation completed successfully!</div>

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-app.js";
    import { 
      getFirestore, 
      collection, 
      addDoc, 
      onSnapshot, 
      doc, 
      updateDoc, 
      deleteDoc, 
      query, 
      orderBy 
    } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-firestore.js";

    // Firebase configuration - REPLACE WITH YOUR ACTUAL CONFIG
    const firebaseConfig = {
      apiKey: "your-api-key",
      authDomain: "your-project.firebaseapp.com",
      projectId: "your-project-id",
      storageBucket: "your-project.appspot.com",
      messagingSenderId: "123456789",
      appId: "your-app-id"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    window.db = db; // Make globally available

    // DOM Elements
    const wordsTable = document.getElementById("wordsTable");
    const searchInput = document.getElementById("search");
    const suggestionsDiv = document.getElementById("suggestions");
    const tausugInput = document.getElementById("tausug");
    const englishInput = document.getElementById("english");
    const addBtn = document.getElementById("addBtn");
    const notification = document.getElementById("notification");

    const wordsCol = collection(db, "dictionary");
    let allWords = []; // Store all words for search functionality

    // Show notification
    function showNotification(message, isError = false) {
      notification.innerHTML = message;
      notification.className = isError ? 'notification error show' : 'notification show';
      
      // Auto-hide after 3 seconds
      setTimeout(() => {
        notification.className = 'notification';
      }, 3000);
    }

    // Add Word
    addBtn.addEventListener("click", async () => {
      const tausug = tausugInput.value.trim();
      const english = englishInput.value.trim();
      
      if (!tausug || !english) {
        showNotification("Please enter both Tausug and English words.", true);
        return;
      }
      
      try {
        // Check if word already exists
        const existingWord = allWords.find(word => 
          word.tausug.toLowerCase() === tausug.toLowerCase()
        );
        
        if (existingWord) {
          showNotification(`"${tausug}" already exists in the dictionary.`, true);
          return;
        }
        
        // Add button loading state
        const originalText = addBtn.innerHTML;
        addBtn.innerHTML = 'Adding...';
        addBtn.disabled = true;
        
        await addDoc(wordsCol, { 
          tausug: tausug.charAt(0).toUpperCase() + tausug.slice(1).toLowerCase(), 
          english: english.charAt(0).toUpperCase() + english.slice(1).toLowerCase() 
        });
        
        tausugInput.value = "";
        englishInput.value = "";
        tausugInput.focus();
        
        showNotification(`"${tausug}" added successfully!`);
      } catch (error) {
        console.error("Error adding word: ", error);
        showNotification("Error adding word. Please try again.", true);
      } finally {
        // Restore button state
        addBtn.innerHTML = 'Add Word';
        addBtn.disabled = false;
      }
    });

    // Render Table and Listen to Firestore Changes
    onSnapshot(query(wordsCol, orderBy("tausug")), (snapshot) => {
      wordsTable.innerHTML = "";
      allWords = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      
      if (allWords.length === 0) {
        wordsTable.innerHTML = `
          <tr>
            <td colspan="3" style="text-align: center; padding: 30px; color: #6c757d;">
              No words in dictionary yet. Add your first word above!
            </td>
          </tr>
        `;
        return;
      }
      
      allWords.forEach(word => {
        const tr = document.createElement("tr");

        // Tausug Cell
        const tausugTd = document.createElement("td");
        tausugTd.contentEditable = true;
        tausugTd.innerText = word.tausug;
        tausugTd.addEventListener("blur", async () => {
          const newTausug = tausugTd.innerText.trim();
          if (!newTausug) {
            tausugTd.innerText = word.tausug;
            showNotification("Tausug word cannot be empty.", true);
            return;
          }
          
          if (newTausug !== word.tausug) {
            try {
              await updateDoc(doc(db, "dictionary", word.id), { 
                tausug: newTausug.charAt(0).toUpperCase() + newTausug.slice(1).toLowerCase() 
              });
              showNotification("Tausug word updated successfully!");
            } catch (error) {
              console.error("Error updating word: ", error);
              tausugTd.innerText = word.tausug;
              showNotification("Error updating word. Please try again.", true);
            }
          }
        });

        // English Cell
        const englishTd = document.createElement("td");
        englishTd.contentEditable = true;
        englishTd.innerText = word.english;
        englishTd.addEventListener("blur", async () => {
          const newEnglish = englishTd.innerText.trim();
          if (!newEnglish) {
            englishTd.innerText = word.english;
            showNotification("English meaning cannot be empty.", true);
            return;
          }
          
          if (newEnglish !== word.english) {
            try {
              await updateDoc(doc(db, "dictionary", word.id), { 
                english: newEnglish.charAt(0).toUpperCase() + newEnglish.slice(1).toLowerCase() 
              });
              showNotification("English meaning updated successfully!");
            } catch (error) {
              console.error("Error updating meaning: ", error);
              englishTd.innerText = word.english;
              showNotification("Error updating meaning. Please try again.", true);
            }
          }
        });

        // Delete Button
        const actionTd = document.createElement("td");
        const delBtn = document.createElement("button");
        delBtn.classList.add("delete-btn");
        delBtn.innerText = "Delete";
        delBtn.addEventListener("click", async () => {
          if (confirm(`Are you sure you want to delete "${word.tausug}"?`)) {
            try {
              await deleteDoc(doc(db, "dictionary", word.id));
              showNotification(`"${word.tausug}" deleted successfully!`);
            } catch (error) {
              console.error("Error deleting word: ", error);
              showNotification("Error deleting word. Please try again.", true);
            }
          }
        });
        actionTd.appendChild(delBtn);

        tr.appendChild(tausugTd);
        tr.appendChild(englishTd);
        tr.appendChild(actionTd);
        wordsTable.appendChild(tr);
      });
    });

    // Search & Suggestions
    searchInput.addEventListener("input", () => {
      const queryText = searchInput.value.toLowerCase().trim();
      
      // Hide suggestions if search is empty
      if (!queryText) {
        suggestionsDiv.style.display = "none";
        filterTable(""); // Show all rows
        return;
      }
      
      // Find matches
      const matches = allWords.filter(word => 
        word.tausug.toLowerCase().includes(queryText) || 
        word.english.toLowerCase().includes(queryText)
      );
      
      // Update suggestions
      suggestionsDiv.innerHTML = "";
      if (matches.length > 0) {
        matches.forEach(word => {
          const div = document.createElement("div");
          div.innerHTML = `<strong>${word.tausug}</strong> → ${word.english}`;
          div.addEventListener("click", () => {
            searchInput.value = word.tausug;
            filterTable(word.tausug.toLowerCase());
            suggestionsDiv.style.display = "none";
          });
          suggestionsDiv.appendChild(div);
        });
        suggestionsDiv.style.display = "block";
      } else {
        suggestionsDiv.style.display = "none";
      }
      
      // Filter table
      filterTable(queryText);
    });

    // Filter table based on search query
    function filterTable(text) {
      const rows = wordsTable.getElementsByTagName("tr");
      
      for (let row of rows) {
        if (row.cells.length < 2) continue; // Skip if not a data row
        
        const tausug = row.cells[0].innerText.toLowerCase();
        const english = row.cells[1].innerText.toLowerCase();
        
        if (tausug.includes(text) || english.includes(text)) {
          row.style.display = "";
        } else {
          row.style.display = "none";
        }
      }
    }

    // Hide suggestions when clicking outside
    document.addEventListener("click", (e) => {
      if (e.target !== searchInput && e.target !== suggestionsDiv) {
        suggestionsDiv.style.display = "none";
      }
    });

    // Allow Enter key to add words
    tausugInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        englishInput.focus();
      }
    });
    
    englishInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        addBtn.click();
      }
    });
  </script>
</body>
</html>
