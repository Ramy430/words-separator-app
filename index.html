<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tausug Dictionary Online - Word Separator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 900px;
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(to right, #6a11cb, #2575fc);
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .municipality {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .description {
            font-size: 1rem;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        .app-content {
            padding: 25px;
        }
        
        .auth-section {
            background-color: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        .user-info {
            text-align: center;
            margin: 10px 0;
            font-weight: bold;
            color: #2e7d32;
        }
        
        .auth-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            justify-content: center;
        }
        
        .auth-btn {
            padding: 8px 15px;
            background: linear-gradient(to right, #4caf50, #2e7d32);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .input-section {
            margin-bottom: 25px;
        }
        
        textarea {
            width: 100%;
            height: 120px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            resize: none;
            font-size: 16px;
        }
        
        textarea:focus {
            outline: none;
            border-color: #6a11cb;
        }
        
        .buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 25px;
            background: linear-gradient(to right, #6a11cb, #2575fc);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .save-btn {
            background: linear-gradient(to right, #2ecc71, #27ae60);
        }
        
        .firebase-btn {
            background: linear-gradient(to right, #FFA000, #FF8F00);
        }
        
        .total-btn {
            background: linear-gradient(to right, #9b59b6, #8e44ad);
        }
        
        .output-section {
            margin-top: 20px;
        }
        
        .output-title {
            font-size: 1.3rem;
            color: #444;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .words-container {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .word-box {
            width: 140px;
            padding: 12px;
            border-radius: 8px;
            background-color: #f8f9fa;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            text-align: center;
        }
        
        .word {
            font-weight: bold;
            color: #2575fc;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .pos {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 8px;
            text-transform: uppercase;
        }
        
        .translation-input {
            width: 100%;
            padding: 8px;
            border: 1px dashed #adb5bd;
            border-radius: 4px;
            font-size: 14px;
            text-align: center;
        }
        
        .translation-input:focus {
            outline: none;
            border-color: #6a11cb;
            border-style: solid;
        }
        
        .instructions {
            background-color: #e8f4fc;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        footer {
            text-align: center;
            padding: 15px;
            background-color: #f8f9fa;
            color: #6c757d;
        }
        
        .footer-text {
            margin: 5px 0;
        }
        
        .save-section {
            margin-top: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 10px;
            text-align: center;
        }
        
        .save-options {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: #2ecc71;
            color: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: none;
            z-index: 1000;
            animation: fadeIn 0.3s, fadeOut 0.3s 2.7s forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-20px); }
        }
        
        .notification.error {
            background: #e74c3c;
        }
        
        .notification.show {
            display: block;
        }
        
        .language-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
            align-items: center;
        }
        
        select {
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .total-display {
            font-size: 1.5rem;
            font-weight: bold;
            color: #6a11cb;
            margin: 10px 0;
        }
        
        .unique-words {
            margin-top: 15px;
            padding: 10px;
            background-color: white;
            border-radius: 8px;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .unique-word {
            display: inline-block;
            background: #e8f4fc;
            padding: 5px 10px;
            margin: 4px;
            border-radius: 20px;
        }

        .firebase-options {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
        }
        
        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            z-index: 1000;
            width: 80%;
            max-width: 500px;
            display: none;
        }
        
        .modal h3 {
            margin-top: 0;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        .firebase-help {
            background-color: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .firebase-help h4 {
            margin-top: 0;
            color: #ff9800;
        }
        
        .copyright {
            font-weight: bold;
            color: #6a11cb;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .btn-loading {
            position: relative;
            color: transparent;
        }
        
        .btn-loading::after {
            content: '';
            position: absolute;
            left: 50%;
            top: 50%;
            margin-left: -10px;
            margin-top: -10px;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .buttons, .auth-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            button, .auth-btn {
                width: 100%;
                justify-content: center;
            }
            
            .word-box {
                width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            header {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Tausug Dictionary Online</h1>
            <div class="municipality">Word Separator Tool | Omar Municipality, Sulu, Philippines</div>
            <div class="description">Separate sentences into words with parts of speech and translations</div>
        </header>
        
        <div class="app-content">
            <div class="auth-section">
                <h4>Authentication Required</h4>
                <p>You need to sign in to save or load translations from Firebase.</p>
                <div class="user-info" id="userInfo">Not signed in</div>
                <div class="auth-buttons">
                    <button class="auth-btn" id="signInBtn"><i class="fas fa-sign-in-alt"></i> Sign In</button>
                    <button class="auth-btn" id="signOutBtn" style="display: none;"><i class="fas fa-sign-out-alt"></i> Sign Out</button>
                </div>
            </div>
            
            <div class="input-section">
                <textarea id="inputText" placeholder="Enter a sentence to analyze...">The quick brown fox jumps over the lazy dog. How amazing!</textarea>
                <div class="language-selector">
                    <span>Translate to:</span>
                    <select id="languageSelect">
                        <option value="en">English</option>
                        <option value="ts">Tausug</option>
                        <option value="ar">Arabic</option>
                        <option value="es">Spanish</option>
                        <option value="fr">French</option>
                        <option value="de">German</option>
                        <option value="it">Italian</option>
                        <option value="pt">Portuguese</option>
                        <option value="custom">Custom (Write your own)</option>
                    </select>
                </div>
                <div class="buttons">
                    <button id="processBtn">
                        <i class="fas fa-cogs"></i> Process Sentence
                    </button>
                    <button id="resetBtn">
                        <i class="fas fa-redo"></i> Reset
                    </button>
                    <button id="totalBtn" class="total-btn">
                        <i class="fas fa-calculator"></i> Total
                    </button>
                </div>
            </div>
            
            <div class="instructions">
                <p><strong>How to use:</strong> Enter a sentence and click "Process Sentence". The app will separate words and identify parts of speech. You can write your translations in the input boxes below each word. All translation fields are fully editable.</p>
            </div>
            
            <div class="firebase-help">
                <h4>Firebase Security Rules</h4>
                <p>For proper security, use these rules in your Firestore Database:</p>
                <pre>
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /translations/{document} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
                </pre>
            </div>
            
            <div class="output-section">
                <h2 class="output-title">Word Analysis</h2>
                <div id="wordsContainer" class="words-container">
                    <!-- Words will be generated here -->
                </div>
            </div>
            
            <div class="total-section">
                <h3>Word Count</h3>
                <div id="totalDisplay" class="total-display">Total Words: 0 | Unique Words: 0</div>
                <div id="uniqueWords" class="unique-words">
                    <!-- Unique words will be displayed here -->
                </div>
            </div>
            
            <div class="save-section">
                <h3>Save Your Translations</h3>
                <p>Click to save:</p>
                <div class="save-options">
                    <button id="saveJsonBtn" class="save-btn">
                        <i class="fas fa-file-export"></i> Export as JSON
                    </button>
                    <button id="copyJsonBtn" class="save-btn">
                        <i class="fas fa-copy"></i> Copy JSON to Clipboard
                    </button>
                </div>

                <div class="firebase-options">
                    <h4>Firebase Storage</h4>
                    <button id="firebaseSaveBtn" class="firebase-btn" disabled>
                        <i class="fas fa-database"></i> Save to Firebase
                    </button>
                    <button id="firebaseLoadBtn" class="firebase-btn" disabled>
                        <i class="fas fa-download"></i> Load from Firebase
                    </button>
                </div>
            </div>
        </div>
        
        <footer>
            <p class="footer-text">Tausug Dictionary Online &copy; 2025 | Analyze and translate text with ease</p>
            <p class="footer-text copyright">Copyright Omar Municipality, Sulu, Philippines</p>
        </footer>
    </div>

    <div class="notification" id="notification">
        File downloaded successfully!
    </div>
    
    <div class="modal-backdrop" id="modalBackdrop"></div>
    
    <div class="modal" id="firebaseModal">
        <h3>Firebase Data</h3>
        <div id="firebaseData"></div>
        <div class="modal-buttons">
            <button id="closeModal">Close</button>
        </div>
    </div>

    <!-- Firebase App (core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <!-- Firebase Firestore -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <!-- Firebase Analytics -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-analytics-compat.js"></script>
    <!-- Firebase Auth -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCgAEuD8F41dH5nUeoVxMot4-rTp4olmr8",
            authDomain: "tausug-dictionary-online.firebaseapp.com",
            projectId: "tausug-dictionary-online",
            storageBucket: "tausug-dictionary-online.firebasestorage.app",
            messagingSenderId: "919499038754",
            appId: "1:919499038754:web:051037787db5a6123c2a7b",
            measurementId: "G-LBKT0624FT"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const analytics = firebase.analytics();
        const db = firebase.firestore();
        const auth = firebase.auth();
        
        console.log("✅ Firebase initialized!");

        document.addEventListener('DOMContentLoaded', function() {
            const processBtn = document.getElementById('processBtn');
            const resetBtn = document.getElementById('resetBtn');
            const totalBtn = document.getElementById('totalBtn');
            const inputText = document.getElementById('inputText');
            const wordsContainer = document.getElementById('wordsContainer');
            const saveJsonBtn = document.getElementById('saveJsonBtn');
            const copyJsonBtn = document.getElementById('copyJsonBtn');
            const firebaseSaveBtn = document.getElementById('firebaseSaveBtn');
            const firebaseLoadBtn = document.getElementById('firebaseLoadBtn');
            const notification = document.getElementById('notification');
            const languageSelect = document.getElementById('languageSelect');
            const totalDisplay = document.getElementById('totalDisplay');
            const uniqueWordsContainer = document.getElementById('uniqueWords');
            const modalBackdrop = document.getElementById('modalBackdrop');
            const firebaseModal = document.getElementById('firebaseModal');
            const firebaseData = document.getElementById('firebaseData');
            const closeModal = document.getElementById('closeModal');
            const signInBtn = document.getElementById('signInBtn');
            const signOutBtn = document.getElementById('signOutBtn');
            const userInfo = document.getElementById('userInfo');
            
            let analyzedWords = [];
            let uniqueWordsSet = new Set();
            let currentUser = null;
            
            // Enhanced parts of speech database
            const partsOfSpeech = {
                'the': 'determiner',
                'a': 'determiner',
                'an': 'determiner',
                'quick': 'adjective',
                'brown': 'adjective',
                'lazy': 'adjective',
                'amazing': 'adjective',
                'fox': 'noun',
                'dog': 'noun',
                'jumps': 'verb',
                'jump': 'verb',
                'over': 'preposition',
                'how': 'adverb',
                'very': 'adverb'
            };
            
            // Enhanced translations database
            const translations = {
                'the': { en: 'the', ts: 'in', ar: 'ال' },
                'quick': { en: 'quick', ts: 'maddas', ar: 'سريع' },
                'brown': { en: 'brown', ts: 'kulay kakah', ar: 'بني' },
                'fox': { en: 'fox', ts: 'urus', ar: 'ثعلب' },
                'jumps': { en: 'jumps', ts: 'lumuksu', ar: 'يقفز' },
                'over': { en: 'over', ts: 'hampang', ar: 'فوق' },
                'lazy': { en: 'lazy', ts: 'malas', ar: 'كسول' },
                'dog': { en: 'dog', ts: 'iru', ar: 'كلب' },
                'how': { en: 'how', ts: 'biyaunu', ar: 'كيف' },
                'amazing': { en: 'amazing', ts: 'mausab', ar: 'مذهل' }
            };
            
            // Authentication state observer
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    userInfo.textContent = `Signed in as: ${user.email}`;
                    signInBtn.style.display = 'none';
                    signOutBtn.style.display = 'block';
                    firebaseSaveBtn.disabled = false;
                    firebaseLoadBtn.disabled = false;
                    showNotification('Signed in successfully!');
                } else {
                    currentUser = null;
                    userInfo.textContent = 'Not signed in';
                    signInBtn.style.display = 'block';
                    signOutBtn.style.display = 'none';
                    firebaseSaveBtn.disabled = true;
                    firebaseLoadBtn.disabled = true;
                }
            });
            
            // Sign in handler
            signInBtn.addEventListener('click', async function() {
                const email = prompt('Please enter your email:');
                if (!email) return;
                
                const password = prompt('Please enter your password:');
                if (!password) return;
                
                try {
                    await auth.signInWithEmailAndPassword(email, password);
                } catch (error) {
                    if (error.code === 'auth/user-not-found') {
                        // Create new user if doesn't exist
                        try {
                            await auth.createUserWithEmailAndPassword(email, password);
                            showNotification('New account created!');
                        } catch (createError) {
                            showNotification('Error creating account: ' + createError.message, true);
                        }
                    } else {
                        showNotification('Sign in error: ' + error.message, true);
                    }
                }
            });
            
            // Sign out handler
            signOutBtn.addEventListener('click', function() {
                auth.signOut();
                showNotification('Signed out successfully');
            });
            
            // Process the sentence
            processBtn.addEventListener('click', function() {
                const sentence = inputText.value.trim();
                if (!sentence) {
                    alert('Please enter a sentence');
                    return;
                }
                
                // Clear previous results
                wordsContainer.innerHTML = '';
                analyzedWords = [];
                uniqueWordsSet.clear();
                
                // Split into words using improved regex
                const words = sentence.split(/\s+|(?=[.,!?;:])|(?<=[.,!?;:])/).filter(word => word.trim() !== '');
                const selectedLanguage = languageSelect.value;
                
                // Create word boxes
                words.forEach(word => {
                    const cleanWord = word.replace(/[.,!?;:"]/g, '').toLowerCase();
                    if (!cleanWord) return; // Skip empty words
                    
                    const pos = partsOfSpeech[cleanWord] || 'unknown';
                    
                    // Get translation if available
                    let translation = '';
                    if (translations[cleanWord] && selectedLanguage !== 'custom') {
                        translation = translations[cleanWord][selectedLanguage] || '';
                    }
                    
                    // Store word data
                    analyzedWords.push({
                        original: word,
                        clean: cleanWord,
                        translation: translation,
                        pos: pos,
                        hasTranslation: !!translation
                    });
                    
                    // Add to unique words set
                    uniqueWordsSet.add(cleanWord);
                    
                    // Create word box
                    const wordBox = document.createElement('div');
                    wordBox.className = 'word-box';
                    
                    const wordEl = document.createElement('div');
                    wordEl.className = 'word';
                    wordEl.textContent = word;
                    
                    const posEl = document.createElement('div');
                    posEl.className = 'pos';
                    posEl.textContent = pos;
                    
                    const translationInput = document.createElement('input');
                    translationInput.type = 'text';
                    translationInput.className = 'translation-input';
                    translationInput.placeholder = 'Enter translation...';
                    translationInput.value = translation;
                    
                    // Update the data model when translation changes
                    translationInput.addEventListener('input', function() {
                        const index = analyzedWords.findIndex(item => item.original === word);
                        if (index !== -1) {
                            analyzedWords[index].translation = this.value;
                            analyzedWords[index].hasTranslation = this.value.trim() !== '';
                        }
                    });
                    
                    wordBox.appendChild(wordEl);
                    wordBox.appendChild(posEl);
                    wordBox.appendChild(translationInput);
                    
                    wordsContainer.appendChild(wordBox);
                });
                
                updateTotalDisplay();
                showNotification(`Processed ${words.length} words`);
            });
            
            // Reset the app
            resetBtn.addEventListener('click', function() {
                inputText.value = '';
                wordsContainer.innerHTML = '';
                analyzedWords = [];
                uniqueWordsSet.clear();
                updateTotalDisplay();
                inputText.focus();
                showNotification('Application reset');
            });
            
            // Calculate and display total
            totalBtn.addEventListener('click', function() {
                updateTotalDisplay();
                showNotification('Total words calculated!');
            });
            
            // Update total display
            function updateTotalDisplay() {
                totalDisplay.textContent = `Total Words: ${analyzedWords.length} | Unique Words: ${uniqueWordsSet.size}`;
                
                // Display unique words
                uniqueWordsContainer.innerHTML = '';
                uniqueWordsSet.forEach(word => {
                    const wordEl = document.createElement('span');
                    wordEl.className = 'unique-word';
                    wordEl.textContent = word;
                    uniqueWordsContainer.appendChild(wordEl);
                });
            }
            
            // Save as JSON
            saveJsonBtn.addEventListener('click', function() {
                if (analyzedWords.length === 0) {
                    alert('Please process a sentence first');
                    return;
                }
                
                // Filter out words without translations if needed
                const wordsWithTranslations = analyzedWords; // We'll save all words
                
                if (wordsWithTranslations.length === 0) {
                    showNotification('No words to save!', true);
                    return;
                }
                
                // Prepare data for export
                const exportData = {
                    words: wordsWithTranslations,
                    language: languageSelect.options[languageSelect.selectedIndex].text,
                    originalSentence: inputText.value,
                    exportDate: new Date().toISOString(),
                    totalWords: wordsWithTranslations.length,
                    uniqueWords: Array.from(uniqueWordsSet)
                };
                
                const content = JSON.stringify(exportData, null, 2);
                downloadFile(content, 'word-translations.json', 'application/json');
                showNotification('File downloaded successfully!');
            });
            
            // Copy JSON to clipboard
            copyJsonBtn.addEventListener('click', function() {
                if (analyzedWords.length === 0) {
                    alert('Please process a sentence first');
                    return;
                }
                
                // Prepare data for export
                const exportData = {
                    words: analyzedWords,
                    language: languageSelect.options[languageSelect.selectedIndex].text,
                    originalSentence: inputText.value,
                    exportDate: new Date().toISOString(),
                    totalWords: analyzedWords.length,
                    uniqueWords: Array.from(uniqueWordsSet)
                };
                
                const content = JSON.stringify(exportData, null, 2);
                
                // Copy to clipboard
                navigator.clipboard.writeText(content).then(() => {
                    showNotification('JSON copied to clipboard!');
                }).catch(err => {
                    alert('Failed to copy JSON: ' + err);
                });
            });
            
            // Save to Firebase
            firebaseSaveBtn.addEventListener('click', async function() {
                if (!currentUser) {
                    showNotification('Please sign in to save to Firebase', true);
                    return;
                }
                
                if (analyzedWords.length === 0) {
                    alert('Please process a sentence first');
                    return;
                }
                
                try {
                    firebaseSaveBtn.classList.add('btn-loading');
                    showNotification('Saving to Firebase...');
                    
                    // Prepare data for saving
                    const saveData = {
                        words: analyzedWords,
                        language: languageSelect.options[languageSelect.selectedIndex].text,
                        originalSentence: inputText.value,
                        savedAt: new Date().toISOString(),
                        totalWords: analyzedWords.length,
                        uniqueWords: Array.from(uniqueWordsSet),
                        userId: currentUser.uid,
                        userEmail: currentUser.email
                    };
                    
                    // Save to Firestore
                    const docRef = await db.collection('translations').add(saveData);
                    
                    showNotification('Translations saved to Firebase successfully!');
                    console.log('Document written with ID: ', docRef.id);
                    
                } catch (error) {
                    console.error("Error saving to Firebase: ", error);
                    if (error.code === 'permission-denied') {
                        showNotification('Firebase permission error. Please update your security rules.', true);
                    } else {
                        showNotification('Error saving to Firebase: ' + error.message, true);
                    }
                } finally {
                    firebaseSaveBtn.classList.remove('btn-loading');
                }
            });
            
            // Load from Firebase
            firebaseLoadBtn.addEventListener('click', async function() {
                try {
                    firebaseLoadBtn.classList.add('btn-loading');
                    showNotification('Loading from Firebase...');
                    
                    // Get data from Firestore
                    const snapshot = await db.collection('translations').orderBy('savedAt', 'desc').limit(10).get();
                    
                    if (snapshot.empty) {
                        showNotification('No saved translations found in Firebase');
                        return;
                    }
                    
                    // Display data in modal
                    firebaseData.innerHTML = '';
                    
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        const item = document.createElement('div');
                        item.className = 'translation-item';
                        
                        item.innerHTML = `
                            <h4>${data.originalSentence}</h4>
                            <p><strong>Language:</strong> ${data.language}</p>
                            <p><strong>Saved:</strong> ${new Date(data.savedAt).toLocaleString()}</p>
                            <p><strong>Words:</strong> ${data.totalWords}</p>
                            <button class="auth-btn load-btn" data-id="${doc.id}">Load This Translation</button>
                        `;
                        
                        firebaseData.appendChild(item);
                    });
                    
                    // Add event listeners to load buttons
                    document.querySelectorAll('.load-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            loadTranslation(this.dataset.id);
                        });
                    });
                    
                    // Show modal
                    modalBackdrop.style.display = 'block';
                    firebaseModal.style.display = 'block';
                    
                    showNotification('Data loaded from Firebase');
                    
                } catch (error) {
                    console.error("Error loading from Firebase: ", error);
                    if (error.code === 'permission-denied') {
                        showNotification('Firebase permission error. Please update your security rules.', true);
                    } else {
                        showNotification('Error loading from Firebase: ' + error.message, true);
                    }
                } finally {
                    firebaseLoadBtn.classList.remove('btn-loading');
                }
            });
            
            // Load a specific translation from Firebase
            async function loadTranslation(docId) {
                try {
                    const doc = await db.collection('translations').doc(docId).get();
                    
                    if (!doc.exists) {
                        showNotification('Translation not found', true);
                        return;
                    }
                    
                    const data = doc.data();
                    
                    // Populate the app with the loaded data
                    inputText.value = data.originalSentence;
                    
                    // Process the sentence
                    processBtn.click();
                    
                    // Wait a bit for processing to complete
                    setTimeout(() => {
                        // Apply translations
                        data.words.forEach((wordData, index) => {
                            if (index < analyzedWords.length) {
                                analyzedWords[index].translation = wordData.translation;
                                analyzedWords[index].hasTranslation = true;
                            }
                        });
                        
                        // Update UI
                        const inputs = document.querySelectorAll('.translation-input');
                        inputs.forEach((input, index) => {
                            if (index < data.words.length) {
                                input.value = data.words[index].translation;
                            }
                        });
                        
                        showNotification('Translation loaded from Firebase!');
                    }, 500);
                    
                    // Close modal
                    closeModal.click();
                    
                } catch (error) {
                    console.error("Error loading translation: ", error);
                    showNotification('Error loading translation: ' + error.message, true);
                }
            }
            
            // Close modal
            closeModal.addEventListener('click', function() {
                modalBackdrop.style.display = 'none';
                firebaseModal.style.display = 'none';
            });
            
            // Helper function to download a file
            function downloadFile(content, fileName, contentType) {
                const blob = new Blob([content], { type: contentType });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = fileName;
                a.click();
                URL.revokeObjectURL(url);
            }
            
            // Show notification
            function showNotification(message, isError = false) {
                notification.textContent = message;
                notification.className = isError ? 'notification error show' : 'notification show';
            }
            
            // Process the example sentence on load
            setTimeout(() => processBtn.click(), 500);
        });
    </script>
</body>
</html>